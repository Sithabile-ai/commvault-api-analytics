<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events & Alerts Configuration - Commvault Analytics</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .header p {
            color: #718096;
            font-size: 16px;
        }

        .nav-links {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-links a {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-size: 14px;
            transition: background 0.3s;
        }

        .nav-links a:hover {
            background: #764ba2;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #718096;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: bold;
            color: #2d3748;
        }

        .stat-card.critical {
            border-left: 5px solid #f56565;
        }

        .stat-card.warning {
            border-left: 5px solid #ed8936;
        }

        .stat-card.success {
            border-left: 5px solid #48bb78;
        }

        .stat-card.info {
            border-left: 5px solid #4299e1;
        }

        .config-score {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .config-score h2 {
            color: #2d3748;
            margin-bottom: 20px;
        }

        .score-bar {
            background: #e2e8f0;
            height: 40px;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #f56565 0%, #ed8936 50%, #48bb78 100%);
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-weight: bold;
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .section h2 {
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.green {
            background: #48bb78;
        }

        .status-indicator.red {
            background: #f56565;
        }

        .status-indicator.gray {
            background: #cbd5e0;
        }

        .status-list {
            list-style: none;
            padding: 0;
        }

        .status-list li {
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .status-list li:last-child {
            border-bottom: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            background: #f7fafc;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            color: #4a5568;
        }

        tr:hover {
            background: #f7fafc;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.critical {
            background: #fed7d7;
            color: #c53030;
        }

        .badge.warning {
            background: #feebc8;
            color: #c05621;
        }

        .badge.info {
            background: #bee3f8;
            color: #2c5282;
        }

        .badge.success {
            background: #c6f6d5;
            color: #2f855a;
        }

        .badge.immediate {
            background: #f56565;
            color: white;
        }

        .badge.high {
            background: #ed8936;
            color: white;
        }

        .badge.medium {
            background: #4299e1;
            color: white;
        }

        .badge.low {
            background: #48bb78;
            color: white;
        }

        .alert-box {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-box.danger {
            background: #fed7d7;
            border-left: 4px solid #f56565;
            color: #742a2a;
        }

        .alert-box.warning {
            background: #feebc8;
            border-left: 4px solid #ed8936;
            color: #7c2d12;
        }

        .alert-box.info {
            background: #bee3f8;
            border-left: 4px solid #4299e1;
            color: #2c5282;
        }

        .alert-box.success {
            background: #c6f6d5;
            border-left: 4px solid #48bb78;
            color: #276749;
        }

        .config-checklist {
            list-style: none;
            padding: 0;
        }

        .config-checklist li {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            display: flex;
            align-items: center;
        }

        .config-checklist li.configured {
            background: #c6f6d5;
        }

        .config-checklist li.not-configured {
            background: #fed7d7;
        }

        .checkmark {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }

        .checkmark.yes {
            background: #48bb78;
            color: white;
        }

        .checkmark.no {
            background: #f56565;
            color: white;
        }

        .action-button {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }

        .action-button:hover {
            background: #764ba2;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #2d3748;
        }

        .instructions {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #4299e1;
            margin-top: 20px;
        }

        .instructions h4 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
            color: #4a5568;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .pool-card {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #f56565;
        }

        .pool-card h4 {
            color: #2d3748;
            margin-bottom: 8px;
        }

        .pool-stats {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #4a5568;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Events & Alerts Configuration Dashboard</h1>
            <p>Monitor event logging and alert configurations for proactive storage management</p>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/dashboard">Main Dashboard</a>
                <a href="/dashboard/storage">Storage Health</a>
                <a href="/dashboard/retention">Retention Health</a>
                <a href="/view/events">View Events</a>
                <a href="/view/alerts">View Alerts</a>
            </div>
        </div>

        <!-- Statistics Grid -->
        <div class="stats-grid">
            <div class="stat-card critical">
                <h3>Critical Events</h3>
                <div class="value">{{ stats.critical_events }}</div>
            </div>
            <div class="stat-card warning">
                <h3>Error Events</h3>
                <div class="value">{{ stats.error_events }}</div>
            </div>
            <div class="stat-card info">
                <h3>Total Events</h3>
                <div class="value">{{ stats.total_events }}</div>
            </div>
            <div class="stat-card {% if stats.enabled_alerts > 0 %}success{% else %}critical{% endif %}">
                <h3>Enabled Alerts</h3>
                <div class="value">{{ stats.enabled_alerts }}</div>
            </div>
        </div>

        <!-- Configuration Score -->
        <div class="config-score">
            <h2>Alert Configuration Health Score</h2>
            <div class="score-bar">
                <div class="score-fill" style="width: {{ stats.config_score }}%;">
                    {{ stats.config_score }}%
                </div>
            </div>
            <p style="margin-top: 15px; color: #718096;">
                {% if stats.config_score >= 80 %}
                    Excellent! Your monitoring configuration is well established.
                {% elif stats.config_score >= 60 %}
                    Good progress, but some improvements recommended.
                {% elif stats.config_score >= 40 %}
                    Moderate configuration. Additional alerts should be configured.
                {% else %}
                    <strong style="color: #c53030;">Critical: Minimal monitoring configured. Immediate action required!</strong>
                {% endif %}
            </p>
        </div>

        <!-- Critical Pools Warning -->
        {% if critical_pools %}
        <div class="alert-box danger">
            <h3 style="margin-bottom: 10px;">URGENT: {{ stats.critical_pools_count }} Critical Storage Pools Detected!</h3>
            <p>The following storage pools are below 10% free space and have NO specific alerts configured:</p>
            <div style="margin-top: 15px;">
                {% for pool in critical_pools %}
                <div class="pool-card">
                    <h4>{{ pool.name }} (ID: {{ pool.id }})</h4>
                    <div class="pool-stats">
                        <span><strong>Free:</strong> {{ pool.pct_free }}%</span>
                        <span><strong>Total:</strong> {{ pool.total_gb }} GB</span>
                        <span><strong>Free Space:</strong> {{ pool.free_gb }} GB</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Configuration Status -->
        <div class="section">
            <h2>Configuration Status</h2>
            <ul class="status-list">
                <li>
                    <span>
                        <span class="status-indicator {% if config_status.events_enabled %}green{% else %}red{% endif %}"></span>
                        Event Logging Enabled
                    </span>
                    <span class="badge {% if config_status.events_enabled %}success{% else %}critical{% endif %}">
                        {% if config_status.events_enabled %}Active ({{ stats.total_events }} events){% else %}Not Configured{% endif %}
                    </span>
                </li>
                <li>
                    <span>
                        <span class="status-indicator {% if config_status.alerts_configured %}green{% else %}red{% endif %}"></span>
                        Alert Definitions Configured
                    </span>
                    <span class="badge {% if config_status.alerts_configured %}success{% else %}critical{% endif %}">
                        {% if config_status.alerts_configured %}{{ stats.total_alerts }} alerts{% else %}None Configured{% endif %}
                    </span>
                </li>
                <li>
                    <span>
                        <span class="status-indicator {% if stats.enabled_alerts > 0 %}green{% else %}red{% endif %}"></span>
                        Enabled Alerts
                    </span>
                    <span class="badge {% if stats.enabled_alerts > 0 %}success{% else %}critical{% endif %}">
                        {{ stats.enabled_alerts }} active
                    </span>
                </li>
                <li>
                    <span>
                        <span class="status-indicator {% if config_status.critical_pools_monitored %}green{% else %}red{% endif %}"></span>
                        Critical Pools Monitored
                    </span>
                    <span class="badge {% if config_status.critical_pools_monitored %}success{% else %}critical{% endif %}">
                        {% if config_status.critical_pools_monitored %}Configured{% else %}Not Configured{% endif %}
                    </span>
                </li>
            </ul>
        </div>

        <!-- Recommended Alert Configurations -->
        <div class="section">
            <h2>Recommended Alert Configurations</h2>
            {% if not config_status.alerts_configured %}
            <div class="alert-box warning">
                <strong>No alerts configured!</strong> Critical storage events may occur without notification. Configure alerts immediately in CommCell Console.
            </div>
            {% endif %}

            <table>
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Alert Name</th>
                        <th>Type</th>
                        <th>Severity</th>
                        <th>Threshold</th>
                        <th>Action</th>
                        <th>Priority</th>
                    </tr>
                </thead>
                <tbody>
                    {% for alert in recommended_alerts %}
                    <tr style="{% if not alert.configured %}background: #fed7d7;{% else %}background: #c6f6d5;{% endif %}">
                        <td>
                            <div class="checkmark {% if alert.configured %}yes{% else %}no{% endif %}">
                                {% if alert.configured %}✓{% else %}✗{% endif %}
                            </div>
                        </td>
                        <td><strong>{{ alert.name }}</strong></td>
                        <td>{{ alert.type }}</td>
                        <td><span class="badge {{ alert.severity.lower() }}">{{ alert.severity }}</span></td>
                        <td>{{ alert.threshold }}</td>
                        <td>{{ alert.action }}</td>
                        <td><span class="badge {{ alert.priority.lower() }}">{{ alert.priority }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="instructions">
                <h4>How to Configure Alerts in CommCell Console:</h4>
                <ol>
                    <li>Log into CommCell Console</li>
                    <li>Navigate to: <strong>Control Panel > Event Management > Alert Definitions</strong></li>
                    <li>Click <strong>"Add"</strong> to create a new alert</li>
                    <li>Configure alert criteria based on recommendations above</li>
                    <li>Set notification recipients (email/SMS)</li>
                    <li>Enable the alert and test delivery</li>
                </ol>
                <p style="margin-top: 15px;">
                    <strong>For detailed configuration steps:</strong> See <a href="/static/EVENTS_ALERTS_FINDINGS.txt" style="color: #667eea;">EVENTS_ALERTS_FINDINGS.txt</a>
                </p>
            </div>
        </div>

        <!-- Current Alert Definitions -->
        <div class="section">
            <h2>Current Alert Definitions ({{ stats.total_alerts }})</h2>
            {% if alert_definitions %}
            <table>
                <thead>
                    <tr>
                        <th>Alert ID</th>
                        <th>Alert Name</th>
                        <th>Type</th>
                        <th>Severity</th>
                        <th>Status</th>
                        <th>Message</th>
                    </tr>
                </thead>
                <tbody>
                    {% for alert in alert_definitions %}
                    <tr>
                        <td>{{ alert.alertId }}</td>
                        <td><strong>{{ alert.alertName or 'N/A' }}</strong></td>
                        <td>{{ alert.alertType or 'N/A' }}</td>
                        <td>
                            {% if alert.severity %}
                            <span class="badge {{ alert.severity.lower() }}">{{ alert.severity }}</span>
                            {% else %}
                            N/A
                            {% endif %}
                        </td>
                        <td>
                            {% if alert.status %}
                            <span class="badge {% if alert.status == 'Enabled' %}success{% else %}warning{% endif %}">
                                {{ alert.status }}
                            </span>
                            {% else %}
                            N/A
                            {% endif %}
                        </td>
                        <td>{{ (alert.alertMessage or 'No description')[:100] }}{% if alert.alertMessage and alert.alertMessage|length > 100 %}...{% endif %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <h3>No Alert Definitions Found</h3>
                <p>No alert definitions have been retrieved from Commvault.</p>
                <p style="margin-top: 10px;">This could mean:</p>
                <ul style="text-align: left; display: inline-block; margin-top: 10px;">
                    <li>Alerts have not been configured in CommCell Console</li>
                    <li>Alert data has not been fetched from API</li>
                    <li>No alerts match the current filter criteria</li>
                </ul>
                <div style="margin-top: 20px;">
                    <a href="/fetch" class="action-button">Fetch Alert Data from API</a>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Recent Critical Events -->
        <div class="section">
            <h2>Recent Critical Events (Last 20)</h2>
            {% if recent_events %}
            <table>
                <thead>
                    <tr>
                        <th>Event ID</th>
                        <th>Code</th>
                        <th>Severity</th>
                        <th>Message</th>
                        <th>Client</th>
                        <th>Subsystem</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event in recent_events %}
                    <tr>
                        <td>{{ event.eventId }}</td>
                        <td>{{ event.eventCode or 'N/A' }}</td>
                        <td><span class="badge {{ event.severity.lower() }}">{{ event.severity }}</span></td>
                        <td>{{ (event.message or 'No message')[:100] }}{% if event.message and event.message|length > 100 %}...{% endif %}</td>
                        <td>{{ event.clientName or 'N/A' }}</td>
                        <td>{{ event.subsystem or 'N/A' }}</td>
                        <td>{{ event.timeSource or 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <h3>No Events Found</h3>
                <p>No events have been retrieved from Commvault.</p>
                <p style="margin-top: 10px;">To populate event data:</p>
                <ol style="text-align: left; display: inline-block; margin-top: 10px;">
                    <li>Configure event logging in CommCell Console</li>
                    <li>Fetch events from API using the data retrieval page</li>
                    <li>Verify events are being generated in Event Viewer</li>
                </ol>
                <div style="margin-top: 20px;">
                    <a href="/fetch" class="action-button">Fetch Event Data from API</a>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Action Items -->
        <div class="section">
            <h2>Immediate Action Items</h2>
            <div class="alert-box {% if stats.config_score < 40 %}danger{% elif stats.config_score < 70 %}warning{% else %}success{% endif %}">
                {% if stats.config_score < 40 %}
                <h3>CRITICAL: Immediate Configuration Required</h3>
                <ul style="margin-top: 15px; margin-left: 20px;">
                    <li>Configure storage pool capacity alerts (< 10%, 20%, 30%)</li>
                    <li>Set up email notifications for critical events</li>
                    <li>Enable event logging in CommCell Console</li>
                    <li>Create alerts for pruning and aging job failures</li>
                    {% if critical_pools %}
                    <li><strong>Configure specific alerts for {{ critical_pools|length }} critical pools</strong></li>
                    {% endif %}
                </ul>
                {% elif stats.config_score < 70 %}
                <h3>Configuration Improvements Recommended</h3>
                <ul style="margin-top: 15px; margin-left: 20px;">
                    <li>Review and enable additional alert definitions</li>
                    <li>Test alert notification delivery</li>
                    <li>Configure alerts for all critical storage pools</li>
                    <li>Set up automated reporting and dashboards</li>
                </ul>
                {% else %}
                <h3>Monitoring Configuration Healthy</h3>
                <p style="margin-top: 10px;">Your events and alerts configuration is in good shape. Continue to monitor and refine as needed.</p>
                <ul style="margin-top: 15px; margin-left: 20px;">
                    <li>Review alert effectiveness quarterly</li>
                    <li>Adjust thresholds based on operational experience</li>
                    <li>Ensure team is trained on alert response procedures</li>
                </ul>
                {% endif %}
            </div>

            <div style="margin-top: 20px;">
                <a href="/static/EVENTS_ALERTS_FINDINGS.txt" class="action-button">View Detailed Configuration Guide</a>
                <a href="/fetch" class="action-button" style="margin-left: 10px;">Fetch Latest Data from API</a>
            </div>
        </div>
    </div>
</body>
</html>
