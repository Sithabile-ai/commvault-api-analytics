====================================================================================================
COMPREHENSIVE PRUNING STRATEGY ANALYSIS
====================================================================================================

Analyzing Micro vs Macro Pruning strategies for optimal space reclamation...

====================================================================================================
SECTION 1: PRUNING TYPES EXPLAINED
====================================================================================================

ðŸ“š PRUNING FUNDAMENTALS

Pruning is the process of PHYSICALLY DELETING aged data from storage.
There are TWO types of pruning strategies:

1. MICROPRUNING (Individual Block Deletion)
   â”œâ”€ What: Deletes individual data blocks as jobs age
   â”œâ”€ When: Enabled by default for cloud/dedup storage
   â”œâ”€ How: Reference counters decremented â†’ Block reaches ref=0 â†’ Deleted
   â”œâ”€ Speed: Gradual, continuous space reclamation
   â”œâ”€ Efficiency: Good for most scenarios
   â””â”€ Best For: Standard backup storage, cloud storage (non-WORM)

2. MACRO PRUNING (Bulk/DDB Seal and Prune)
   â”œâ”€ What: Seals entire DDB, waits for all jobs to age, deletes entire DDB
   â”œâ”€ When: Required for WORM storage, archive cloud
   â”œâ”€ How: Seal DDB â†’ Age all jobs â†’ Delete entire DDB partition
   â”œâ”€ Speed: Slow, bulk deletion only after ALL jobs aged
   â”œâ”€ Efficiency: Requires 3x retention capacity
   â””â”€ Best For: WORM/immutable storage, archive cloud

âš ï¸  CRITICAL DIFFERENCES:

   Micropruning:
   âœ… Space freed incrementally as jobs age
   âœ… Lower storage capacity requirements
   âœ… Faster space reclamation
   âŒ Cannot be used with WORM storage
   âŒ Slower on archive cloud (impractical)

   Macro Pruning:
   âœ… Works with WORM/immutable storage
   âœ… Clean, predictable DDB lifecycle
   âŒ Requires 3x retention storage capacity
   âŒ No space freed until ENTIRE DDB ages
   âŒ Long wait time for space reclamation

====================================================================================================
SECTION 2: CURRENT ENVIRONMENT PRUNING CONFIGURATION
====================================================================================================

Total Storage Pools: 79

Storage Pool Categorization:
  - Disk Pools: 79
  - Cloud Pools: 0
  - Tape Pools: 0

  - Deduplication Enabled: 0
  - Non-Dedup: 79

====================================================================================================
SECTION 3: PRUNING STRATEGY RECOMMENDATIONS BY POOL TYPE
====================================================================================================

ðŸ“Š ANALYSIS BY STORAGE TYPE

ðŸ“¦ ARCHIVE CLOUD STORAGE

   Pruning Type: MACRO PRUNING (Required)
   Reason: Micropruning is impractical (extremely slow) on archive cloud

   Archive Cloud Best Practice:
   - Seal DDB periodically (e.g., every 6 months or yearly)
   - Wait for all jobs in sealed DDB to meet retention
   - Macro prune entire sealed DDB
   - Archive cloud optimized for write-once-read-rarely, not individual deletes

ðŸ’¾ NON-DEDUPLICATION POOLS (79 pools)

   Pruning Type: DIRECT DELETION (Simplest)
   Reason: No reference counting needed

   How Non-Dedup Pruning Works:
   1. Job ages
   2. Job files directly deleted from disk
   3. Space immediately freed
   No DDB, no reference counting, no pending delete queue

   Troubleshooting Non-Dedup Pruning:
   1. Check CVMA.log on MediaAgent for pruning activity
   2. Verify mount paths are accessible
   3. Check MediaAgent is online

====================================================================================================
SECTION 4: STORAGE POOL PRUNING HEALTH ASSESSMENT
====================================================================================================

Pruning Health Status:
  âœ… Healthy Pools (>30% free): 61
  ðŸ”´ Failing Pools (<20% free): 11

ðŸš¨ POOLS WITH FAILING PRUNING (Immediate Action Required):

Pool Name                                          % Free     Dedup    Type                 Recommended Action
------------------------------------------------------------------------------------------------------------------------
Apex GDP                                               1.97% No       1                    Check CVMA logs
Southern_Sun_Durban                                    2.05% No       1                    Check CVMA logs
Simera_GDP                                             9.30% No       1                    Check CVMA logs
Southern_Sun_City_Bowl                                12.47% No       1                    Check CVMA logs
MKLM_GDP                                              12.85% No       1                    Check CVMA logs
GDP Railway                                           12.98% No       1                    Check CVMA logs
Universal GDP                                         13.37% No       1                    Check CVMA logs
CLMAN02_Storage                                       14.75% No       1                    Check CVMA logs
Capri_Local_GDP                                       14.75% No       1                    Check CVMA logs
Southern_Sun_Local                                    17.80% No       1                    Check CVMA logs
EnergyPartners_Local                                  18.96% No       1                    Check CVMA logs

====================================================================================================
SECTION 5: MACRO PRUNING CAPACITY PLANNING
====================================================================================================

ðŸ“Š CAPACITY REQUIREMENTS FOR MACRO PRUNING

Most Common Retention Configurations:
Retention Days       Cycles     # Rules         Macro Pruning Capacity
--------------------------------------------------------------------------------
14 days              2          130             3x 14 days = ~42 days capacity
10 days              1          79              3x 10 days = ~30 days capacity
365 days             1          70              3x 365 days = ~1095 days capacity
30 days              1          58              3x 30 days = ~90 days capacity
30 days              0          18              3x 30 days = ~90 days capacity
93 days              1          17              3x 93 days = ~279 days capacity
730 days             1          16              3x 730 days = ~2190 days capacity
15 days              1          14              3x 15 days = ~45 days capacity
10 days              0          12              3x 10 days = ~30 days capacity
7 days               1          11              3x 7 days = ~21 days capacity

ðŸ’¡ INTERPRETATION:

If switching to Macro Pruning (seal and prune strategy):
  - Must maintain 3 DDB partitions simultaneously
  - Each partition holds data for retention period
  - Total capacity = 3x normal retention capacity

Example: 30-day retention
  - DDB 1: Days 1-30 (Active)
  - DDB 2: Days 31-60 (Sealed, immutable)
  - DDB 3: Days 61-90 (Aged, ready to delete)
  - Need capacity for 90 days data, not 30 days

âš ï¸  This is why micropruning is preferred when possible!

====================================================================================================
SECTION 6: PRUNING OPTIMIZATION RECOMMENDATIONS
====================================================================================================

ðŸŽ¯ IMMEDIATE ACTIONS (Priority Order):

1. âš ï¸  FIX MICROPRUNING ON 11 CRITICAL POOLS

   Step-by-Step Troubleshooting:

   A. Verify MediaAgent Health
      - Location: CommCell Console â†’ Storage Resources â†’ MediaAgents
      - Check: All MediaAgents for critical pools show 'Online'
      - Action: Restart offline MediaAgents

   B. Check DDB Status (Dedup Pools Only)
      - Location: CommCell Console â†’ Storage â†’ Deduplication Engines
      - Right-click DDB â†’ Properties â†’ Status
      - Expected: 'Active' (not 'Sealed')
      - Check: 'Pending Deletes' count
        â€¢ Normal: <10,000
        â€¢ Warning: 10,000-100,000
        â€¢ Critical: >100,000 (severe backlog)

   C. Manually Trigger Pruning
      - Location: Right-click DDB â†’ All Tasks
      - Select: 'Validate and Prune Aged Data'
      - Monitor: Job progress and space freed
      - Repeat for each critical pool

   D. Review Pruning Logs
      - Location: MediaAgent â†’ <Install>/Log Files/
      - Logs: SIDBPrune.log, SIDBPhysicalDeletes.log, SIDBEngine.log
      - Look for: Errors, warnings, 'skipped' messages
      - Common issues:
        â€¢ Mount path not accessible
        â€¢ Resource exhaustion (CPU/Memory/Disk)
        â€¢ Pruning operation window restrictions

2. ðŸ”§ OPTIMIZE CONFIGURATION FOR MICROPRUNING

   A. Remove Extended Retention from Dedup Copies
      - Extended retention on dedup delays pruning for ALL jobs
      - Recommendation: Create separate selective copies for long-term retention
      - Benefit: Faster pruning on primary dedup storage

   B. Verify Micropruning Enabled
      - Location: Storage Policy â†’ Copy â†’ Advanced â†’ Deduplication Options
      - Setting: 'Enable micro pruning' should be CHECKED
      - Default: Enabled for cloud dedup

   C. Reduce Cycle Requirements (From Previous Analysis)
      - 130 rules have â‰¤30 days + 2 cycles
      - Change to 1 cycle for faster aging
      - Faster aging = Faster pruning eligibility

====================================================================================================
SECTION 7: ONGOING MONITORING & VERIFICATION
====================================================================================================

ðŸ“Š KEY METRICS TO MONITOR:

1. Storage Pool Free Space Trend
   - Track % free daily
   - Expected: Stable or increasing (if pruning works)
   - Alert: Decreasing trend = pruning not keeping up

2. Pending Delete Queue (Dedup Pools)
   - Query: Check SIDBEngine.log for 'Pending Deletes' count
   - Expected: <10,000
   - Alert: >100,000 = severe pruning backlog

3. Mark and Sweep Operation
   - Query: Check SIDBEngine.log for 'Mark And Sweep.Last Run'
   - Expected: Daily execution
   - Alert: No execution in 7+ days = pruning stalled

4. MMDeletedAF Table Row Count
   - Query: SELECT COUNT(*) FROM MMDeletedAF (CommServe database)
   - Expected: Low count (aged jobs quickly pruned)
   - Alert: High/growing count = pruning backlog

5. Pruning Job Success Rate
   - Location: Job Controller â†’ Filter by 'Pruning'
   - Expected: >95% success rate
   - Alert: Failed jobs or 0 bytes pruned

====================================================================================================
SECTION 8: PRUNING STRATEGY DECISION TREE
====================================================================================================

ðŸŒ³ USE THIS DECISION TREE TO CHOOSE PRUNING STRATEGY:

START: What type of storage?
â”‚
â”œâ”€ DEDUPLICATION STORAGE
â”‚  â”‚
â”‚  â”œâ”€ Q: Is WORM/Immutability enabled?
â”‚  â”‚  â”œâ”€ YES â†’ MACRO PRUNING (Required)
â”‚  â”‚  â”‚        â”œâ”€ Plan for 3x retention capacity
â”‚  â”‚  â”‚        â”œâ”€ Seal DDB periodically (6-12 months)
â”‚  â”‚  â”‚        â””â”€ Macro prune after full aging
â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€ NO â†’ MICROPRUNING (Recommended)
â”‚  â”‚           â”œâ”€ Enabled by default
â”‚  â”‚           â”œâ”€ Gradual space reclamation
â”‚  â”‚           â””â”€ Monitor SIDBPrune.log
â”‚
â”œâ”€ CLOUD STORAGE
â”‚  â”‚
â”‚  â”œâ”€ Q: Is this Archive Cloud?
â”‚  â”‚  â”œâ”€ YES â†’ MACRO PRUNING (Required)
â”‚  â”‚  â”‚        â””â”€ Micropruning impractical on archive
â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€ NO â†’ Check WORM status
â”‚  â”‚           â”œâ”€ WORM enabled â†’ MACRO PRUNING
â”‚  â”‚           â””â”€ WORM disabled â†’ MICROPRUNING (Default)
â”‚
â”œâ”€ NON-DEDUP DISK
â”‚  â”‚
â”‚  â””â”€ DIRECT DELETION (Simplest)
â”‚     â”œâ”€ Job ages â†’ Files deleted
â”‚     â”œâ”€ No DDB complexity
â”‚     â””â”€ Monitor CVMA.log
â”‚
â””â”€ TAPE
   â”‚
   â””â”€ TAPE RECLAMATION
      â”œâ”€ Different process (not pruning)
      â””â”€ Refer to tape reclamation docs

====================================================================================================
SECTION 9: EXECUTIVE SUMMARY
====================================================================================================

ðŸ“‹ ENVIRONMENT OVERVIEW:

  Total Storage Pools: 79
    - Dedup Pools: 0 (Micropruning recommended)
    - Non-Dedup: 79 (Direct deletion)
    - Cloud Pools: 0 (Verify WORM status)

  Pruning Health:
    - âœ… Healthy (>30% free): 61 pools
    - ðŸ”´ Critical (<20% free): 11 pools

  âš ï¸  CRITICAL FINDING:
    11 pools critically low on space
    This is PROOF that pruning (micropruning) is NOT working!

ðŸŽ¯ RECOMMENDED PRUNING STRATEGY:

  Primary Strategy: MICROPRUNING
    - Used by: Most dedup and cloud pools
    - Benefit: Gradual space reclamation, lower capacity needs
    - Status: Currently FAILING (evidence: critical pools)

  Exception: MACRO PRUNING
    - Required for: WORM storage, archive cloud
    - Trade-off: 3x capacity requirement
    - Action: Verify if any pools require this

ðŸš€ NEXT STEPS:

  1. Execute troubleshooting steps for critical pools (Section 6)
  2. Verify micropruning is enabled on all dedup pools
  3. Check for WORM-enabled pools requiring macro pruning
  4. Implement monitoring for key pruning metrics (Section 7)
  5. Re-run this analysis in 7 days to verify improvements

====================================================================================================
ANALYSIS COMPLETE
====================================================================================================

ðŸ“„ Review sections above for detailed findings and recommendations
ðŸ”§ Implement priority actions to restore pruning functionality
ðŸ“Š Monitor key metrics to track improvement

